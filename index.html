<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel="stylesheet" type="text/css" href="main.css">

    <script src="https://unpkg.com/web3@latest/dist/web3.min.js"></script>
	
	<script src="https://unpkg.com/@metamask/detect-provider/dist/detect-provider.min.js"></script>
	
	<script>
window.addEventListener('load', function() {

if (typeof window.ethereum !== 'undefined') {
	console.log('MetaMask is installed!');
	window.web3 = new Web3(window.ethereum);
//	detectEthereumProvider((err, res) => {
	//	if (!err) {
		//window.web3 = new Web3(res);
//		} else { 
	//	console.log("Can't detect provider");
		//}
//	});
	} else {
		console.log('MetaMask NOT found!');
	}
})
</script>
</head>
<body>
    <div class="container">

        <h1>Bulls Investing Club</h1>

		<button id="cnbutton" onclick="getAccount()">Connect Metamask</button>
		
		<label for="name" class="col-lg-2 control-label">Status</label>
		<label id="status" class="col-lg-2 control-label"></label>
		
		<button id="gabutton" onclick="showAccounts()">Get accounts</button>
		
		<label for="name" class="col-lg-2 control-label">Accounts</label>
		<div id="accounts"></div>

    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

    <script>
		async function getAccount() {
			const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
		//	const account = accounts[0];
			// showAccount.innerHTML = account;
	//		let accList = "";
		//	for (let i = 0; i < accounts.length; i++) {
		//		accList = accounts[i] + "<br />";
	//		}
			if (accounts.length) {
				document.getElementById('status').innerHTML = "connected !";
			} else {
				document.getElementById('status').innerHTML = "can't connect MetaMask";
			}
		//	console.log(accList);
		}
		
		function showAccounts() {
  web3.eth.getAccounts((err, res) => {
    let output = "";

    if (!err) {

      for (i=0; i< res.length; i++){
        let account = res[i];
		
		console.log(account);
		
        web3.eth.getBalance(account, (err2, res2) => {
		
		
          if (!err2) {
            // web3.eth.getBalance(res[i]) returns an instanceof BigNumber
            output += "Account= "+ account +", balance= " + res2 + " (wei), "+ web3.utils.fromWei(res2, 'ether') +" (ether)<br />";

          } else {
            output = "Error2";
          }
		      document.getElementById('accounts').innerHTML = output + "<br />";
          })
      }

    } else {
      output = "Error1";
    }
	
    document.getElementById('accounts').innerHTML = output + "<br />";
	console.log("end");
  })
}
		
    </script>

</body>
</html>