<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel="stylesheet" type="text/css" href="main.css">

    <script src="https://unpkg.com/web3@latest/dist/web3.min.js"></script>
	
	<script src="./metamask-onboarding.bundle.js"></script>
	

</head>
<body>
    <div class="container">

        <h1>Bulls Investing Club</h1>

	<button id="onboard">Loading...</button>

    <script>
      window.addEventListener('DOMContentLoaded', () => {
        const onboarding = new MetaMaskOnboarding();
        const onboardButton = document.getElementById('onboard');
        let accounts;

        const updateButton = () => {
          if (!MetaMaskOnboarding.isMetaMaskInstalled()) {
            onboardButton.innerText = 'Click here to install MetaMask!';
            onboardButton.onclick = () => {
              onboardButton.innerText = 'Onboarding in progress';
              onboardButton.disabled = true;
              onboarding.startOnboarding();
            };
          } else if (accounts && accounts.length > 0) {
            onboardButton.innerText = 'Connected';
			window.web3 = new Web3(window.ethereum);
            onboardButton.disabled = true;
            onboarding.stopOnboarding();
          } else {
            onboardButton.innerText = 'Connect';
            onboardButton.onclick = async () => {
              await window.ethereum.request({
                method: 'eth_requestAccounts',
              });
            };
          }
        };

        updateButton();
        if (MetaMaskOnboarding.isMetaMaskInstalled()) {
          window.ethereum.on('accountsChanged', (newAccounts) => {
            accounts = newAccounts;
            updateButton();
          });
        }
      });
    </script>


		<button id="gabutton" onclick="showAccounts()">Get accounts</button>
		
		<label for="name" class="col-lg-2 control-label">Accounts</label>
		<div id="accounts"></div>

    </div>

    <script>
		async function getAccount() {
		
			if (typeof window.ethereum === 'undefined') return;
		
			const accounts = await ethereum.request({ method: 'eth_requestAccounts' });

			if (accounts.length) {
				document.getElementById('status').innerHTML = "connected !";
			} else {
				document.getElementById('status').innerHTML = "can't connect MetaMask";
			}
		}
		
		function showAccounts() {
		
		if (typeof window.ethereum === 'undefined') return;
		
  web3.eth.getAccounts((err, res) => {
    let output = "";

    if (!err) {

      for (i=0; i< res.length; i++){
        let account = res[i];
		
		console.log(account);
		
        web3.eth.getBalance(account, (err2, res2) => {
		
		
          if (!err2) {
            // web3.eth.getBalance(res[i]) returns an instanceof BigNumber
            output += "Account= "+ account +", balance= " + res2 + " (wei), "+ web3.utils.fromWei(res2, 'ether') +" (ether)<br />";

          } else {
            output = "Error2";
          }
		      document.getElementById('accounts').innerHTML = output + "<br />";
          })
      }

    } else {
      output = "Error1";
    }
	
    document.getElementById('accounts').innerHTML = output + "<br />";
	console.log("end");
  })
}
		
    </script>

</body>
</html>
